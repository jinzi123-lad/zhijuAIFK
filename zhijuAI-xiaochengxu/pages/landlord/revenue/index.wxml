<view class="container pb-24">
  <view class="mesh-gradient"></view>
  <navbar title="收入趋势" showBack="{{true}}"></navbar>

  <view class="main-body px-4 pt-4">
    <!-- Year Selector -->
    <view class="flex-row mb-4">
         <block wx:for="{{years}}" wx:key="*this">
             <view class="year-pill {{selectedYear === item ? 'active bg-primary text-white' : 'glass-card text-muted'}} icon-hover-bounce"
                   bindtap="setYear" data-year="{{item}}">
                   {{item}}年
             </view>
         </block>
    </view>

    <!-- Summary Cards -->
    <view class="grid-3 mb-4">
        <view class="stats-card glass-card">
            <text class="stats-lbl text-muted">年度总收入</text>
            <text class="stats-val text-primary">¥{{stats.totalIncome}}k</text>
        </view>
         <view class="stats-card glass-card">
            <text class="stats-lbl text-muted">月均收入</text>
            <text class="stats-val">¥{{stats.avgIncome}}k</text>
        </view>
         <view class="stats-card glass-card">
            <text class="stats-lbl text-muted">年度增长</text>
            <view class="flex-row text-success">
                 <icon name="revenue" color="#10b981" size="24"></icon>
                 <text class="ml-1 stats-val-sm">{{stats.growth}}%</text>
            </view>
        </view>
    </view>

    <!-- Chart Section -->
    <view class="chart-card glass-card p-4">
        <view class="flex-row space-between mb-4">
            <text class="section-title font-bold text-sm">月度收入趋势</text>
            <view class="toggle-group bg-muted-20 p-1 flex-row">
                 <view class="toggle-item {{viewMode==='bar' ? 'bg-white shadow' : 'text-muted'}}" bindtap="setViewMode" data-mode="bar">柱状图</view>
                 <view class="toggle-item {{viewMode==='line' ? 'bg-white shadow' : 'text-muted'}}" bindtap="setViewMode" data-mode="line">折线图</view>
            </view>
        </view>

        <!-- Bar Chart -->
        <block wx:if="{{viewMode === 'bar'}}">
             <view class="chart-bars">
                 <block wx:for="{{monthlyData}}" wx:key="month">
                     <view class="bar-row flex-row mb-2">
                         <text class="bar-label text-muted w-10 text-xs">{{item.month}}</text>
                         <view class="bar-track flex-1 bg-muted-20 rounded-lg h-8 relative mx-2">
                             <view class="bar-fill h-full bg-gradient-primary rounded-lg flex-row items-center justify-end pr-2" style="width:{{item.percent}}%;">
                                 <text class="bar-val text-white text-xs">¥{{item.income}}k</text>
                             </view>
                             <block wx:if="{{item.hitTarget}}">
                                 <view class="check-badge bg-success rounded-full centered">
                                     <icon name="check" color="#ffffff" size="16"></icon>
                                 </view>
                             </block>
                         </view>
                         <text class="bar-target text-muted w-16 text-right text-xs">目标 {{item.target}}k</text>
                     </view>
                 </block>
             </view>
        </block>

        <!-- Line Chart Mock -->
        <block wx:else>
             <view class="line-chart-area centered p-4">
                 <text class="text-muted text-sm">-- 折线图绘制区域 (Canvas) --</text>
                 <!-- In real implementation, use f2-canvas here -->
                 <view class="mock-line-chart mt-4" style="width:100%; height:200rpx; position:relative; border-bottom:1px solid #ddd; border-left:1px solid #ddd;">
                      <view style="position:absolute; bottom:20%; left:10%; width:10rpx; height:10rpx; background:blue; border-radius:50%;"></view>
                      <view style="position:absolute; bottom:40%; left:30%; width:10rpx; height:10rpx; background:blue; border-radius:50%;"></view>
                      <view style="position:absolute; bottom:60%; left:50%; width:10rpx; height:10rpx; background:blue; border-radius:50%;"></view>
                      <view style="position:absolute; bottom:50%; left:70%; width:10rpx; height:10rpx; background:blue; border-radius:50%;"></view>
                       <!-- Simple visual placeholder -->
                 </view>
             </view>
        </block>
    </view>
  </view>
</view>
