<!--房东-房产备案页面-->
<view class="container">
  <view class="mesh-gradient"></view>
  <navbar title="房产备案" showBack="{{true}}"></navbar>

  <view class="main-body">
    <!-- 加载中 -->
    <view class="loading" wx:if="{{loading}}">加载中...</view>

    <block wx:if="{{!loading}}">
      <!-- 状态卡片 -->
      <view class="status-card glass-card {{certifications.length > 0 ? 'approved' : 'none'}}">
        <view class="status-icon-box">
          <icon wx:if="{{certifications.length === 0}}" name="building" color="#64748b" size="56"></icon>
          <icon wx:else name="checkCircle" color="#10b981" size="56"></icon>
        </view>
        <view class="status-info">
          <text class="status-title">
            <text wx:if="{{certifications.length === 0}}">未备案</text>
            <text wx:else>已备案 {{certifications.length}} 处房产</text>
          </text>
          <text class="status-desc">
            <text wx:if="{{certifications.length === 0}}">上传房产证明，获得"已备案"标识，提升租客信任度</text>
            <text wx:else>您的房产已完成备案，享受更多权益</text>
          </text>
        </view>
      </view>

      <!-- 已有备案列表 -->
      <view class="cert-list" wx:if="{{certifications.length > 0}}">
        <view class="cert-item glass-card" wx:for="{{certifications}}" wx:key="id">
          <view class="cert-header">
            <view class="cert-info">
              <text class="cert-address">{{item.property_address}}</text>
              <text class="cert-owner">产权人：{{item.owner_name || '未填写'}}</text>
            </view>
            <view class="cert-status {{item.status}}">{{item.statusText}}</view>
          </view>
          
          <image wx:if="{{item.certificate_image}}" class="cert-preview" src="{{item.certificate_image}}" mode="aspectFit" bindtap="previewImage" data-url="{{item.certificate_image}}"></image>
          
          <text class="reject-reason" wx:if="{{item.status === 'rejected' && item.reject_reason}}">
            驳回原因：{{item.reject_reason}}
          </text>
        </view>
      </view>

      <!-- 添加备案表单 -->
      <view class="form-section glass-card">
        <view class="form-title">添加房产备案</view>
        
        <view class="form-group">
          <text class="form-label">房产地址 <text class="required">*</text></text>
          <input class="form-input" placeholder="请输入房产详细地址" value="{{newCert.propertyAddress}}" bindinput="onAddressInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">产权人姓名</text>
          <input class="form-input" placeholder="请输入产权人姓名" value="{{newCert.ownerName}}" bindinput="onOwnerInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">房产证号</text>
          <input class="form-input" placeholder="请输入房产证编号" value="{{newCert.certificateNo}}" bindinput="onCertNoInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">房产证照片 <text class="required">*</text></text>
          <view class="upload-row">
            <view class="upload-item">
              <view class="upload-box {{newCert.certificateImage ? 'has-image' : ''}}" bindtap="uploadCertificate">
                <image wx:if="{{newCert.certificateImage}}" class="cert-image" src="{{newCert.certificateImage}}" mode="aspectFit"></image>
                <view wx:else class="upload-placeholder">
                  <icon name="camera" color="#64748b" size="56"></icon>
                  <text class="upload-text">点击上传房产证</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 提交按钮 -->
      <button class="submit-btn" bindtap="submitCertification" disabled="{{submitting}}">
        <icon name="plus" color="#fff" size="32"></icon>
        <text>{{submitting ? '提交中...' : '提交备案'}}</text>
      </button>
    </block>
  </view>
</view>