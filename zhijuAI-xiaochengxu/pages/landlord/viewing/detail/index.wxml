<view class="page-container">
  <navbar title="é¢„çº¦è¯¦æƒ…" />

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>

  <block wx:if="{{!loading && appointment}}">
    <!-- çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card status-{{appointment.status}}">
      <text class="status-icon">
        {{appointment.status === 'pending' ? 'â³' : appointment.status === 'confirmed' ? 'âœ…' : appointment.status === 'cancelled' ? 'âŒ' : 'ğŸ“…'}}
      </text>
      <text class="status-text">
        {{appointment.status === 'pending' ? 'å¾…ç¡®è®¤' : appointment.status === 'confirmed' ? 'å·²ç¡®è®¤' : appointment.status === 'cancelled' ? 'å·²å–æ¶ˆ' : 'å¾…å¤„ç†'}}
      </text>
    </view>

    <!-- æˆ¿æºä¿¡æ¯ -->
    <view class="info-card">
      <view class="card-title">ğŸ  æˆ¿æºä¿¡æ¯</view>
      <view class="info-row">
        <text class="label">æˆ¿æº</text>
        <text class="value">{{appointment.propertyTitle}}</text>
      </view>
      <view class="info-row">
        <text class="label">åœ°å€</text>
        <text class="value">{{appointment.propertyAddress}}</text>
      </view>
    </view>

    <!-- ç§Ÿå®¢ä¿¡æ¯ -->
    <view class="info-card">
      <view class="card-title">ğŸ‘¤ ç§Ÿå®¢ä¿¡æ¯</view>
      <view class="tenant-row">
        <view class="tenant-avatar">{{appointment.tenantName[0]}}</view>
        <view class="tenant-info">
          <text class="tenant-name">{{appointment.tenantName}}</text>
          <text class="tenant-phone">{{appointment.tenantPhone}}</text>
        </view>
        <view class="call-btn" bindtap="callTenant">ğŸ“</view>
      </view>
    </view>

    <!-- é¢„çº¦ä¿¡æ¯ -->
    <view class="info-card">
      <view class="card-title">ğŸ“… é¢„çº¦ä¿¡æ¯</view>
      <view class="info-row">
        <text class="label">æ—¥æœŸ</text>
        <text class="value highlight">{{appointment.date}}</text>
      </view>
      <view class="info-row">
        <text class="label">æ—¶æ®µ</text>
        <text class="value highlight">{{appointment.time}}</text>
      </view>
      <view class="info-row" wx:if="{{appointment.notes}}">
        <text class="label">å¤‡æ³¨</text>
        <text class="value">{{appointment.notes}}</text>
      </view>
      <view class="info-row">
        <text class="label">æäº¤æ—¶é—´</text>
        <text class="value muted">{{appointment.createdAt}}</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-bar" wx:if="{{appointment.status === 'pending'}}">
      <view class="action-btn cancel" bindtap="openCancel">å–æ¶ˆé¢„çº¦</view>
      <view class="action-btn reschedule" bindtap="openReschedule">æ”¹æœŸ</view>
      <view class="action-btn confirm" bindtap="confirmAppointment">ç¡®è®¤</view>
    </view>
  </block>

  <!-- æ”¹æœŸå¼¹çª— -->
  <view class="modal-mask" wx:if="{{showRescheduleModal}}" bindtap="closeReschedule">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">æ”¹æœŸçœ‹æˆ¿</text>
        <text class="close-btn" bindtap="closeReschedule">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">æ–°æ—¥æœŸ</text>
          <picker mode="date" bindchange="onRescheduleDateChange">
            <view class="picker-value">{{rescheduleDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">æ–°æ—¶æ®µ</text>
          <picker range="{{['ä¸Šåˆ', 'ä¸‹åˆ', 'æ™šä¸Š']}}" bindchange="onRescheduleTimeChange">
            <view class="picker-value">{{rescheduleTime || 'è¯·é€‰æ‹©æ—¶æ®µ'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">åŸå› ï¼ˆå¯é€‰ï¼‰</text>
          <textarea placeholder="å¦‚ï¼šæ˜å¤©æœ‰äº‹" bindinput="onRescheduleReasonInput" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="submit-btn" bindtap="submitReschedule">å‘é€æ”¹æœŸè¯·æ±‚</button>
      </view>
    </view>
  </view>

  <!-- å–æ¶ˆå¼¹çª— -->
  <view class="modal-mask" wx:if="{{showCancelModal}}" bindtap="closeCancel">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">å–æ¶ˆé¢„çº¦</text>
        <text class="close-btn" bindtap="closeCancel">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="reason-title">è¯·é€‰æ‹©å–æ¶ˆåŸå› ï¼š</view>
        <view class="reason-options">
          <view class="reason-option {{cancelReason === 'æˆ¿æºå·²ç§Ÿå‡º' ? 'selected' : ''}}" bindtap="selectCancelReason" data-reason="æˆ¿æºå·²ç§Ÿå‡º">æˆ¿æºå·²ç§Ÿå‡º</view>
          <view class="reason-option {{cancelReason === 'æš‚ä¸å‡ºç§Ÿ' ? 'selected' : ''}}" bindtap="selectCancelReason" data-reason="æš‚ä¸å‡ºç§Ÿ">æš‚ä¸å‡ºç§Ÿ</view>
          <view class="reason-option {{cancelReason === 'æ—¶é—´å†²çª' ? 'selected' : ''}}" bindtap="selectCancelReason" data-reason="æ—¶é—´å†²çª">æ—¶é—´å†²çª</view>
          <view class="reason-option {{cancelReason === 'å…¶ä»–åŸå› ' ? 'selected' : ''}}" bindtap="selectCancelReason" data-reason="å…¶ä»–åŸå› ">å…¶ä»–åŸå› </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="submit-btn cancel-btn" bindtap="submitCancel">ç¡®è®¤å–æ¶ˆ</button>
      </view>
    </view>
  </view>
</view>
