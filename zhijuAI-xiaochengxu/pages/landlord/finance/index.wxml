<view class="container pb-24">
  <view class="mesh-gradient"></view>
  <navbar title="智居AI-财务报表" showBack="{{true}}"></navbar>

  <view class="main-body px-4 pt-4">
    <!-- Period Selector -->
    <view class="flex-row mb-4">
      <block wx:for="{{['month', 'quarter', 'year']}}" wx:key="*this">
        <view 
            class="period-pill {{selectedPeriod === item ? 'active bg-primary text-white' : 'glass-card text-muted'}} icon-hover-bounce"
            bindtap="setPeriod" 
            data-period="{{item}}">
            {{item === 'month' ? '月度' : (item === 'quarter' ? '季度' : '年度')}}
        </view>
      </block>
    </view>

    <!-- Summary Cards -->
    <view class="summary-grid mb-4">
        <!-- Income -->
        <view class="summary-card glass-card shadow-md">
            <view class="flex-row space-between mb-2">
                <text class="text-xs text-muted">总收入</text>
                <icon name="property" color="#10b981" size="32"></icon> <!-- TrendingUp -->
            </view>
            <view class="text-2xl font-bold mb-1">¥{{financialSummary.totalIncome}}</view>
            <view class="flex-row text-xs text-success">
                <text>↑ {{financialSummary.incomeGrowth}}%</text>
            </view>
        </view>

        <!-- Expense -->
        <view class="summary-card glass-card shadow-md">
             <view class="flex-row space-between mb-2">
                <text class="text-xs text-muted">总支出</text>
                <!-- TrendingDown icon? Use chart for now or generic -->
                <icon name="chart" color="#ef4444" size="32"></icon>
            </view>
            <view class="text-2xl font-bold mb-1">¥{{financialSummary.totalExpense}}</view>
             <view class="flex-row text-xs text-success">
                <!-- Abs for growth shown as positive here? Next.js logic was Abs -->
                <text>↓ {{financialSummary.expenseGrowth}}%</text>
            </view>
        </view>

        <!-- Net Profit -->
        <view class="summary-card glass-card shadow-md col-span-2">
             <view class="flex-row space-between mb-2">
                <text class="text-xs text-muted">净利润</text>
                <icon name="dollar" color="#2563eb" size="32"></icon>
            </view>
            <view class="text-3xl font-bold text-primary mb-1">¥{{financialSummary.netProfit}}</view>
            <view class="flex-row text-xs text-success">
                <text>较上月增长 {{financialSummary.profitGrowth}}%</text>
            </view>
        </view>
    </view>

    <!-- Revenue Trend Chart Mock -->
    <view class="section mb-4">
        <text class="section-title">收入趋势</text>
        <view class="glass-card p-4 rounded-2xl">
            <view class="chart-list">
                <block wx:for="{{monthlyRevenue}}" wx:key="month">
                    <view class="chart-item mb-2">
                        <view class="flex-row space-between text-xs mb-1">
                            <text class="text-muted">{{item.month}}</text>
                            <text class="text-bold">¥{{item.income}}</text>
                        </view>
                        <view class="progress-bar-bg">
                            <view class="progress-bar-fill" style="width: {{item.percent}}%;"></view>
                        </view>
                    </view>
                </block>
            </view>
        </view>
    </view>

    <!-- Recent Payments -->
    <view class="section">
        <view class="flex-row space-between mb-2">
            <text class="section-title">最近账单</text>
            <view class="flex-row text-primary text-xs" bindtap="viewAllPayments">
                <text>查看全部</text>
                <icon name="chevronRight" color="#2563eb" size="24"></icon>
            </view>
        </view>
        
        <view class="payment-list">
            <block wx:for="{{recentPayments}}" wx:key="id">
                <view class="payment-card glass-card p-4 mb-2 icon-hover-bounce">
                    <view class="flex-row space-between mb-1">
                        <view>
                            <text class="text-sm font-bold block">{{item.typeLabel}} - 房间{{item.propertyId}}</text>
                             <text class="text-xs text-muted">应缴日期: {{item.dueDate}}</text>
                        </view>
                        <view class="text-right">
                             <view class="text-lg font-bold text-primary">¥{{item.amount}}</view>
                             <view class="badge {{item.statusClass}}">{{item.statusLabel}}</view>
                        </view>
                    </view>
                    
                     <block wx:if="{{item.status === 'overdue'}}">
                        <view class="flex-row text-destructive text-xs mt-1">
                             <icon name="alert" color="#ef4444" size="24"></icon>
                             <text class="ml-1">已逾期</text> 
                        </view>
                     </block>
                </view>
            </block>
        </view>
    </view>

  </view>
</view>
