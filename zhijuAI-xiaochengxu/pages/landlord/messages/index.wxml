<!--æˆ¿ä¸œ-æ¶ˆæ¯ä¸­å¿ƒé¡µé¢-->
<navbar title="æ¶ˆæ¯ä¸­å¿ƒ" showBack="{{false}}" background="#FFFFFF"></navbar>

<view class="messages-page">
  <!-- é¡¶éƒ¨Tab -->
  <view class="tabs-container">
    <view 
      wx:for="{{tabs}}" 
      wx:key="key" 
      class="tab-item {{currentTab === item.key ? 'active' : ''}}"
      bindtap="switchTab" 
      data-tab="{{item.key}}"
    >
      {{item.label}}
    </view>
    <view class="mark-all" bindtap="markAllRead" wx:if="{{unreadCount > 0}}">
      å…¨éƒ¨å·²è¯»
    </view>
  </view>

  <!-- æœªè¯»æç¤º -->
  <view class="unread-tip" wx:if="{{unreadCount > 0}}">
    <text>æ‚¨æœ‰ {{unreadCount}} æ¡æœªè¯»æ¶ˆæ¯</text>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <view class="message-list" wx:if="{{!loading}}">
    <block wx:for="{{messages}}" wx:key="id">
      <view 
        wx:if="{{currentTab === 'all' || item.type === currentTab}}"
        class="message-item {{!item.is_read ? 'unread' : ''}}" 
        bindtap="goToDetail" 
        data-id="{{item.id}}"
      >
        <view class="msg-icon">{{item.typeIcon}}</view>
        <view class="msg-content">
          <view class="msg-title">
            {{item.title}}
            <view class="unread-dot" wx:if="{{!item.is_read}}"></view>
          </view>
          <view class="msg-desc">{{item.content}}</view>
          <view class="msg-time">{{item.timeText}}</view>
        </view>
        <view class="msg-arrow">â€º</view>
      </view>
    </block>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:if="{{!loading && messages.length === 0}}">
    <text class="empty-icon">ğŸ“­</text>
    <text class="empty-text">æš‚æ— æ¶ˆæ¯</text>
  </view>
</view>

<!-- åº•éƒ¨å¯¼èˆª -->
<landlord-tabbar selected="messages"></landlord-tabbar>
