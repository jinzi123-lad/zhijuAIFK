<view class="page-container">
  <navbar title="å›¢é˜Ÿç®¡ç†" />

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>

  <view class="member-list" wx:if="{{!loading}}">
    <view class="member-card" wx:for="{{members}}" wx:key="id">
      <view class="member-avatar">{{item.name[0]}}</view>
      <view class="member-info">
        <view class="name-row">
          <text class="name">{{item.name}}</text>
          <text class="role-badge role-{{item.role}}">{{item.roleName}}</text>
        </view>
        <text class="phone">{{item.phone}}</text>
        <text wx:if="{{item.status === 'pending'}}" class="pending-tip">å¾…æ¥å—é‚€è¯·</text>
      </view>
      <view class="member-actions">
        <view class="action-btn" catchtap="openRoleModal" data-id="{{item.id}}">ç¼–è¾‘</view>
        <view class="action-btn danger" catchtap="removeMember" data-id="{{item.id}}">ç§»é™¤</view>
      </view>
    </view>

    <view wx:if="{{members.length === 0}}" class="empty">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">æš‚æ— å›¢é˜Ÿæˆå‘˜</text>
      <text class="empty-hint">æ·»åŠ ç®¡å®¶ã€é”€å”®ã€è´¢åŠ¡ç­‰ååŠ©ç®¡ç†</text>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="fab-btn" bindtap="openAddModal">+ æ·»åŠ æˆå‘˜</view>

  <!-- æ·»åŠ æˆå‘˜å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showAddModal}}" bindtap="closeAddModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ å›¢é˜Ÿæˆå‘˜</text>
        <text class="close-btn" bindtap="closeAddModal">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="section">
          <text class="section-title">æˆå‘˜æ‰‹æœºå·</text>
          <input class="phone-input" placeholder="è¾“å…¥æˆå‘˜æ‰‹æœºå·" type="number" maxlength="11" bindinput="onPhoneInput" value="{{newMemberPhone}}" />
        </view>
        <view class="section">
          <text class="section-title">é€‰æ‹©è§’è‰²</text>
          <view class="role-list">
            <view class="role-item {{newMemberRole === item.id ? 'active' : ''}}"
              wx:for="{{roles}}" wx:key="id"
              bindtap="selectRole" data-role="{{item.id}}">
              <text class="role-name">{{item.name}}</text>
              <text class="role-desc">{{item.desc}}</text>
            </view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="submit-btn" bindtap="sendInvite">å‘é€é‚€è¯·</button>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘è§’è‰²å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showRoleModal}}" bindtap="closeRoleModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘ {{selectedMember.name}} çš„è§’è‰²</text>
        <text class="close-btn" bindtap="closeRoleModal">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="role-list">
          <view class="role-item {{selectedMember.role === item.id ? 'active' : ''}}"
            wx:for="{{roles}}" wx:key="id"
            bindtap="selectRole" data-role="{{item.id}}">
            <text class="role-name">{{item.name}}</text>
            <text class="role-desc">{{item.desc}}</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="submit-btn" bindtap="saveRole">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>