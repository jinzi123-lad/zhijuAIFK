<view class="page-container">
  <navbar title="æˆ‘çš„è´¦å•" />

  <!-- Tabåˆ‡æ¢ -->
  <view class="tabs">
    <view class="tab {{currentTab === 'pending' ? 'active' : ''}}" bindtap="switchTab" data-tab="pending">å¾…ç¼´è´¹</view>
    <view class="tab {{currentTab === 'paid' ? 'active' : ''}}" bindtap="switchTab" data-tab="paid">å·²ç¼´è´¹</view>
  </view>

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>

  <view class="bill-list" wx:if="{{!loading}}">
    <view class="bill-card" wx:for="{{bills}}" wx:key="id"
      wx:if="{{(currentTab === 'pending' && item.status === 'pending') || (currentTab === 'paid' && (item.status === 'paid' || item.status === 'confirmed'))}}">
      
      <view class="card-header">
        <view class="type-icon">{{item.type === 'rent' ? 'ğŸ ' : 'ğŸ’¡'}}</view>
        <view class="bill-info">
          <text class="type-text">{{item.typeText}}</text>
          <text class="property-name">{{item.propertyTitle}}</text>
        </view>
        <view class="amount">Â¥{{item.amount}}</view>
      </view>

      <view class="card-body">
        <view class="info-row">
          <text class="label">{{item.status === 'pending' ? 'åº”ç¼´æ—¥æœŸ' : 'ç¼´è´¹æ—¥æœŸ'}}</text>
          <text class="value {{item.isOverdue ? 'overdue' : ''}}">
            {{item.status === 'pending' ? item.dueDate : item.paidDate}}
            <text wx:if="{{item.isOverdue}}" class="overdue-tag">å·²é€¾æœŸ</text>
          </text>
        </view>
        <view class="info-row">
          <text class="label">çŠ¶æ€</text>
          <text class="value status-{{item.status}}">{{item.statusText}}</text>
        </view>
      </view>

      <view class="card-footer" wx:if="{{item.status === 'pending'}}">
        <view class="pay-btn" catchtap="openPayModal" data-id="{{item.id}}">å»ç¼´è´¹</view>
      </view>
    </view>

    <view wx:if="{{bills.length === 0}}" class="empty">
      <text class="empty-icon">ğŸ’°</text>
      <text class="empty-text">æš‚æ— è´¦å•</text>
    </view>
  </view>

  <!-- æ”¯ä»˜å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showPayModal}}" bindtap="closePayModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">ç¼´è´¹</text>
        <text class="close-btn" bindtap="closePayModal">âœ•</text>
      </view>
      
      <view class="modal-body" wx:if="{{selectedBill}}">
        <view class="pay-amount">
          <text class="label">åº”ç¼´é‡‘é¢</text>
          <text class="amount">Â¥{{selectedBill.amount}}</text>
        </view>

        <view class="qrcode-section">
          <text class="section-title">æ‰«ç æ”¯ä»˜</text>
          <image class="qrcode-image" src="{{paymentQrcode}}" mode="aspectFit" bindlongpress="saveQrcode" />
          <text class="qrcode-tip">é•¿æŒ‰ä¿å­˜æ”¶æ¬¾ç </text>
        </view>

        <view class="proof-section">
          <text class="section-title">ä¸Šä¼ æ”¯ä»˜å‡­è¯</text>
          <view class="proof-upload" bindtap="chooseProofImage">
            <image wx:if="{{proofImage}}" src="{{proofImage}}" class="proof-image" mode="aspectFill" />
            <view wx:else class="upload-placeholder">
              <text class="upload-icon">ğŸ“·</text>
              <text class="upload-text">ç‚¹å‡»ä¸Šä¼ æˆªå›¾</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="submit-btn" bindtap="submitPayment">æäº¤ç¼´è´¹å‡­è¯</button>
      </view>
    </view>
  </view>
</view>