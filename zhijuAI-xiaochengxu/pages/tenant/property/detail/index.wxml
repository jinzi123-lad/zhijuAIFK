<view class="page-container">
  <navbar title="æˆ¿æºè¯¦æƒ…" />

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>
  
  <block wx:if="{{!loading && property}}">
    <!-- å›¾ç‰‡è½®æ’­ -->
    <swiper class="property-swiper" indicator-dots autoplay circular>
      <swiper-item wx:for="{{property.images}}" wx:key="index">
        <image src="{{item}}" mode="aspectFill" class="swiper-image" />
      </swiper-item>
      <swiper-item wx:if="{{property.images.length === 0}}">
        <image src="/images/placeholder.png" mode="aspectFill" class="swiper-image" />
      </swiper-item>
    </swiper>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="info-card">
      <view class="title-row">
        <text class="property-title">{{property.title}}</text>
        <view wx:if="{{property.certified}}" class="badge certified">å·²å¤‡æ¡ˆ</view>
      </view>
      <view class="price-row">
        <text class="price">Â¥{{property.price}}</text>
        <text class="unit">/æœˆ</text>
        <text class="deposit">æŠ¼é‡‘ Â¥{{property.deposit}}</text>
      </view>
      <view class="meta-row">
        <text class="meta-item">{{property.layout}}</text>
        <text class="divider">|</text>
        <text class="meta-item">{{property.area}}ã¡</text>
        <text class="divider">|</text>
        <text class="meta-item">{{property.floor}}</text>
      </view>
      <view class="address-row">
        <text class="icon">ğŸ“</text>
        <text class="address">{{property.location}} {{property.address}}</text>
      </view>
    </view>

    <!-- é…å¥—è®¾æ–½ -->
    <view class="section-card">
      <view class="section-title">é…å¥—è®¾æ–½</view>
      <view class="facilities">
        <view class="facility-tag" wx:for="{{property.facilities}}" wx:key="index">{{item}}</view>
      </view>
    </view>

    <!-- æˆ¿æºä»‹ç» -->
    <view class="section-card">
      <view class="section-title">æˆ¿æºä»‹ç»</view>
      <view class="description">{{property.description}}</view>
    </view>

    <!-- æˆ¿ä¸œä¿¡æ¯ -->
    <view class="section-card landlord-card">
      <view class="landlord-info">
        <view class="avatar">ğŸ‘¤</view>
        <view class="landlord-detail">
          <text class="name">{{property.landlord.name}}</text>
          <view wx:if="{{property.landlord.verified}}" class="verified-badge">å·²å®åè®¤è¯</view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <view class="action-btn secondary">æ”¶è—</view>
      <view class="action-btn primary" bindtap="openAppointment">é¢„çº¦çœ‹æˆ¿</view>
    </view>
  </block>

  <!-- é¢„çº¦å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showAppointmentModal}}" bindtap="closeAppointment">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">é¢„çº¦çœ‹æˆ¿</text>
        <text class="close-btn" bindtap="closeAppointment">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">é€‰æ‹©æ—¥æœŸ</text>
          <picker mode="date" start="{{today}}" bindchange="onDateChange">
            <view class="picker-value">{{appointmentDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">é€‰æ‹©æ—¶æ®µ</text>
          <picker range="{{['ä¸Šåˆ', 'ä¸‹åˆ', 'æ™šä¸Š']}}" bindchange="onTimeChange">
            <view class="picker-value">{{appointmentTime || 'è¯·é€‰æ‹©æ—¶æ®µ'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
          <textarea placeholder="å¦‚ï¼šå¸Œæœ›èƒ½çœ‹å¨æˆ¿" bindinput="onNotesInput" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="submit-btn" bindtap="submitAppointment">ç¡®è®¤é¢„çº¦</button>
      </view>
    </view>
  </view>
</view>
