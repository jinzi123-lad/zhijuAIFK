<view class="page-container">
  <navbar title="æˆ‘çš„æŠ¥ä¿®" />

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>

  <view class="repair-list" wx:if="{{!loading}}">
    <view class="repair-card" wx:for="{{repairs}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}">
      <view class="card-header">
        <view class="category-icon">{{item.category === 'plumbing' ? 'ğŸš¿' : item.category === 'electrical' ? 'ğŸ’¡' : item.category === 'appliance' ? 'ğŸ“º' : item.category === 'structure' ? 'ğŸšª' : 'ğŸ”§'}}</view>
        <view class="repair-info">
          <text class="title">{{item.title}}</text>
          <text class="meta">{{item.categoryName}} Â· {{item.createdAt}}</text>
        </view>
        <text class="status-tag status-{{item.status}}">{{item.statusText}}</text>
      </view>

      <!-- å¾…ç¡®è®¤æ“ä½œ -->
      <view class="card-footer" wx:if="{{item.status === 'completed'}}">
        <view class="confirm-btn" catchtap="confirmComplete" data-id="{{item.id}}">ç¡®è®¤å®Œæˆ</view>
      </view>
    </view>

    <view wx:if="{{repairs.length === 0}}" class="empty">
      <text class="empty-icon">ğŸ”§</text>
      <text class="empty-text">æš‚æ— æŠ¥ä¿®è®°å½•</text>
    </view>
  </view>

  <!-- æ–°å»ºæŒ‰é’® -->
  <view class="fab-btn" bindtap="openCreateModal">+ æ–°å¢æŠ¥ä¿®</view>

  <!-- æ–°å»ºæŠ¥ä¿®å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showCreateModal}}" bindtap="closeCreateModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">æ–°å¢æŠ¥ä¿®</text>
        <text class="close-btn" bindtap="closeCreateModal">âœ•</text>
      </view>
      
      <view class="modal-body">
        <!-- åˆ†ç±»é€‰æ‹© -->
        <view class="section">
          <text class="section-title">é—®é¢˜ç±»å‹</text>
          <view class="category-grid">
            <view class="category-item {{newRepair.category === item.id ? 'active' : ''}}"
              wx:for="{{categories}}" wx:key="id"
              bindtap="selectCategory" data-category="{{item.id}}">
              <text class="category-icon">{{item.icon}}</text>
              <text class="category-name">{{item.name}}</text>
            </view>
          </view>
        </view>

        <!-- é—®é¢˜æè¿° -->
        <view class="section">
          <text class="section-title">é—®é¢˜æè¿°</text>
          <input class="input-box" placeholder="ç®€è¦æè¿°é—®é¢˜ï¼ˆå¦‚ï¼šå¨æˆ¿æ°´é¾™å¤´æ¼æ°´ï¼‰" bindinput="onTitleInput" value="{{newRepair.title}}" />
        </view>

        <view class="section">
          <text class="section-title">è¯¦ç»†è¯´æ˜ï¼ˆå¯é€‰ï¼‰</text>
          <textarea class="textarea-box" placeholder="è¯¦ç»†æè¿°é—®é¢˜æƒ…å†µ..." bindinput="onDescriptionInput" value="{{newRepair.description}}" />
        </view>

        <!-- ä¸Šä¼ å›¾ç‰‡ -->
        <view class="section">
          <text class="section-title">ä¸Šä¼ ç…§ç‰‡</text>
          <view class="image-grid">
            <view class="image-item" wx:for="{{newRepair.images}}" wx:key="index">
              <image src="{{item}}" mode="aspectFill" class="uploaded-image" />
              <view class="remove-btn" catchtap="removeImage" data-index="{{index}}">âœ•</view>
            </view>
            <view class="add-image" wx:if="{{newRepair.images.length < 9}}" bindtap="chooseImages">
              <text class="add-icon">ğŸ“·</text>
              <text class="add-text">æ·»åŠ ç…§ç‰‡</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="submit-btn" bindtap="submitRepair">æäº¤æŠ¥ä¿®</button>
      </view>
    </view>
  </view>
</view>